// Copyright 2013 lovebear https://github.com/lovebear/lazyseq.js
function Generator(t,e,i){this.data=t,i&&(this.transform=i),this.opts={min:void 0},Array.isArray(this.data)&&(this._datatype="array"),this._akeys=Object.keys(this.data),this._akeys=this._akeys.reverse(),this._idx=[],this._len=[],this.alen=this._akeys.length;for(var n=0;this.alen>n;n++)this._idx.push(0),this._len.push(this.data[this._akeys[n]].length);this._init=!0,this._done=!1,this._step=1,this._last=""}function LazySeq(t){this.data=t}Generator.prototype.take=function(t){for(var e,i=[],n=0;t>n&&(e=this.next(),e);n++)i.push(e);return i},Generator.prototype.reset=function(){for(var t=0,e=this._idx.length;e>t;t++)this._idx[t]=0;this._done=!1,this._init=!0},Generator.prototype._adjustIdx=function(){},Generator.prototype.transform=function(t){return t},Generator.prototype.next=function(){if(this._init?this._init=!1:this._adjustIdx(),this._done)return void 0;for(var t=this._datatype?[]:{},e=0;this.alen>e;e++)t[this._akeys[e]]=this.data[this._akeys[e]][this._idx[e]];return 2==this._step?this._last=this.transform(t,this.next()):his._last=this.transform(t),this._last},LazySeq.prototype.cartesian=function(t){var e=new Generator(this.data,t);return e._adjustIdx=function(){for(var t=this.alen;t>0;t--){if(this._idx[t-1]<this._len[t-1]-1){this._idx[t-1]++;break}this._idx[t-1]=0,1==t&&(this._done=!0)}},e.__defineGetter__("length",function(){var t=0;return t=this._len.reduce(function(t,e){return t*e})}),e},LazySeq.prototype.filter=function(){var t=new Generator(this.data);return t._adjustIdx=function(){},t},LazySeq.prototype.map=function(t){var e=new Generator(this.data,{},t);return e._adjustIdx=function(){if(!this._done)for(var t=0,e=this._idx.length;e>t;t++){if(this._idx[t]>this._len[t]){this._done=!0;break}this._idx[t]++}},e},LazySeq.prototype.reduce=function(t){var e=new Generator(this.data,{},t);return e._step=2,e._adjustIdx=function(){if(!this._done)for(var t=0,e=this._idx.length;e>t;t++){if(this._idx[t]>this._len[t]){this._done=!0;break}this._idx[t]++}},e},LazySeq.prototype.interleave=function(){var t=new Generator(this.data);return t._adjustIdx=function(){},t},"undefined"!=typeof module&&module.exports&&(module.exports=LazySeq);